# 🃏 Quatre-Vingt 在线八十分游戏

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.12+](https://img.shields.io/badge/python-3.12+-blue.svg)](https://www.python.org/downloads/)
[![Vue.js 3](https://img.shields.io/badge/Vue.js-3.x-4FC08D.svg)](https://vuejs.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.100+-00A8CC.svg)](https://fastapi.tiangolo.com/)

一个专门为"八十分"纸牌游戏设计的在线平台，让4个朋友可以远程一起享受这个经典的双人合作纸牌游戏。

## ✨ 特性

- 🎮 **专注八十分** - 专门为八十分游戏设计，规则完整准确
- 🌐 **实时同步** - WebSocket技术确保4人游戏状态实时同步
- 👥 **固定4人** - 严格按照八十分规则，必须4人才能开始游戏
- 📱 **响应式设计** - 完美适配桌面和移动设备
- 🎨 **精美UI** - 现代化的游戏界面设计
- 🔒 **安全可靠** - 完善的用户认证和游戏状态管理

## 🛠️ 技术栈

### 前端
- **框架**: Vue.js 3 + TypeScript
- **UI库**: Element Plus / Vuetify
- **状态管理**: Pinia
- **实时通信**: Socket.io-client
- **构建工具**: Vite

### 后端
- **框架**: Python + FastAPI
- **实时通信**: WebSocket + Socket.io
- **数据库**: PostgreSQL (主数据库) + Redis (缓存)
- **认证**: JWT Token
- **部署**: Railway

### 部署
- **前端**: Vercel (自动部署)
- **后端**: Railway (自动部署)
- **数据库**: Railway PostgreSQL + Redis

## 📁 项目结构

```
quatre-vingt/
├── frontend/                 # Vue.js前端应用
│   ├── src/
│   │   ├── components/      # 可复用组件
│   │   ├── views/           # 页面组件
│   │   ├── stores/          # Pinia状态管理
│   │   ├── services/        # API服务
│   │   └── utils/           # 工具函数
│   ├── public/              # 静态资源
│   └── package.json
├── backend/                  # Python后端应用
│   ├── app/
│   │   ├── api/             # API路由
│   │   ├── core/            # 核心配置
│   │   ├── models/          # 数据模型
│   │   ├── services/        # 业务逻辑
│   │   ├── websocket/      # WebSocket处理
│   │   └── game/           # 八十分游戏逻辑
│   ├── requirements.txt
│   └── main.py
├── assets/                  # 游戏资源
│   └── cards/              # 纸牌图片资源
├── docs/                   # 项目文档
└── README.md
```

## 🚀 快速开始

### 环境要求

- **Python**: 3.12+
- **Node.js**: 18+
- **Git**: 最新版本

### 本地开发

#### 1. 克隆项目
```bash
git clone https://github.com/EmericZLT/quatre-vingt.git
cd quatre-vingt
```

#### 2. 后端设置
```bash
# 进入后端目录
cd backend

# 创建虚拟环境（推荐）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 启动开发服务器
python main.py
```

#### 3. 前端设置
```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

#### 4. 访问应用
- 前端: http://localhost:3000
- 后端API: http://localhost:8000
- API文档: http://localhost:8000/docs

## 🌐 部署

### 自动部署（推荐）

项目配置了自动部署，当你推送代码到main分支时：

1. **前端**会自动部署到Vercel
2. **后端**会自动部署到Railway

### 手动部署

#### 前端部署到Vercel
1. 连接GitHub仓库到Vercel
2. 设置构建命令：`npm run build`
3. 设置输出目录：`dist`

#### 后端部署到Railway
1. 连接GitHub仓库到Railway
2. 设置环境变量
3. 自动检测Python项目并部署

## 🎮 八十分游戏规则

### 游戏概述
八十分是一种四人纸牌游戏，使用两副扑克牌（108张），四人分为两队，南北对家一队，东西对家一队。游戏目标是通过得分和升级，先打过A的队伍获胜。

### 基本设置
- **人数**: 固定4人，分为两个队伍，对家为同一队
- **牌数**: 两副扑克牌，共108张
- **发牌**: 每人25张，留8张作为底牌
- **起始级别**: 从2开始，逐级升级到A

### 重要概念
- **级牌**: 当前游戏级别对应的牌，如打2时级牌是2，打10时级牌是10
- **主牌花色**: 通过亮主确定的将牌花色，该花色的所有牌都是主牌
- **主牌**: 包括大王、小王、所有级牌以及主牌花色的所有牌
- **副牌**: 除主牌外的其他牌
- **亮主**: 玩家在抓牌过程中亮出级牌确定主牌花色
- **反主**: 用更大的牌型反掉已亮出的主牌，反主顺序：单张级牌 < 级牌对子 < 双小王 < 双大王
- **跟牌**: 有该花色必须出该花色，有对应牌型时必须匹配
- **垫牌**: 没有该花色时垫出其他花色的牌，垫牌小于领出牌
- **将吃（毙牌）**: 没有该花色时用主牌"吃"掉领出的牌，必须牌型匹配
- **超将吃**: 当一家将吃后，另一家可用更大的主牌超将吃
- **分牌**: 5（5分）、10和K（各10分），总分200分
- **抠底**: 闲家最后一圈获胜时，按牌型倍数获得底牌分数
- **升级**: 根据闲家得分决定是否升级和换庄

### 牌型与大小

#### 牌的大小顺序
**主牌大小顺序**（以打10为例，级牌为10）：
```
2<3<4<5<6<7<8<9<J<Q<K<A<副10<主10<小王<大王
```
- **副10**: 非主牌花色的10
- **主10**: 主牌花色的10
- **级牌**: 当前级别的牌，在主牌中最大（除大小王外）
- **注意**: 级牌会随游戏级别变化，如打2时级牌是2，打3时级牌是3

**副牌大小顺序**：
```
2<3<4<5<6<7<8<9<J<Q<K<A
```

**注意**: 级牌会随着游戏进行而变化（2→3→4→...→A），将牌中的级牌大小也会相应调整。

#### 基本牌型
- **单张**: 一张牌
- **对子**: 两张花色点数都相同的牌
- **连对（拖拉机）**: 级别相邻且花色相同的两个或以上对子
- **甩牌**: 将手中某门花色的多张牌一起打出

### 游戏流程

#### 1. 抓牌与亮主
- 每人抓25张牌，留8张底牌
- 玩家在抓牌过程中可亮出级牌确定主牌花色
- **反主顺序**：
  - 单张级牌 < 双张级牌（对子）< 双小王 < 双大王
  - 级牌对子花色顺序：♦<♣<♥<♠（方块<梅花<红桃<黑桃）
- 无人亮主时翻底牌确定主牌

#### 2. 扣底
- 庄家获得底牌后，必须扣出8张牌作为新底牌
- 庄家可将分牌放入底牌中

#### 3. 出牌规则

**基本出牌流程**：
- 庄家首先出牌，此后由上一圈获胜者出牌
- 其他玩家按逆时针顺序出牌
- 每圈出牌数量必须相同

**跟牌规则**：
- **有该花色必须出该花色**：如果手中有领出者所出花色的牌，必须出该花色的牌
- **牌型匹配条件**：只有在手中有对应牌型且有该花色时才必须匹配
  - 领出单张：有该花色单张必须出单张，否则可出对子拆成单张
  - 领出对子：有该花色对子必须出对子，否则可出两单张
  - 领出连对：有该花色连对必须出连对，否则按优先级跟牌：有对子必须出对子，对子不足则出单张

**垫牌**：
- **定义**：当手中没有或不全有领出花色的牌时，可以垫出其他花色的牌
- **规则**：必须先出完所有该花色的牌，然后才能垫其他花色的牌
- **大小**：垫牌小于领出牌，无法获胜

**将吃（毙牌）**：
- **定义**：当手中没有领出花色的牌时，可以用主牌（将牌）来"吃"掉领出的牌
- **条件**：必须手中完全没有该花色的牌
- **牌型匹配**：将吃必须牌型完全匹配
  - 领出单张 → 用单张主牌将吃
  - 领出对子 → 用对子主牌将吃
  - 领出连对 → 用连对主牌将吃
- **超将吃**：当一家将吃后，另一家可用更大的主牌超将吃

#### 4. 计分规则

**分牌定义**：
- **5**: 5分
- **10**: 10分  
- **K**: 10分
- **总分**: 200分（两副牌）

**得分方式**：
- **吃墩得分**: 每圈获胜者获得该圈所有分牌
- **庄家得分**: 庄家方获胜时，分牌归庄家方
- **闲家得分**: 闲家方获胜时，分牌归闲家方

**抠底规则**：
- **条件**: 闲家最后一圈获胜
- **倍数**: 按最后一圈牌型计算
  - 单张：2倍
  - 对子：4倍
  - 连对：8倍（每多一对×2）
  - 甩牌：按最大牌型计算倍数

**升级规则**：
- **闲家得分<80**: 庄家升级，庄家方换人坐庄
- **闲家得分≥80**: 闲家升级并上庄，由上局庄家的下家坐庄
- **升级幅度**: 按得分每10分升一级

#### 5. 胜负条件
- 双方从2开始逐级升级
- 先打过A的队伍获胜

### 特殊规则

#### 拖拉机规则
- 必须级别相邻且花色相同
- **将牌拖拉机**: ♠2233、♠99JJ（以♠为主牌且级牌为10时，2和3相邻，9和J相邻）
- **副牌拖拉机**: 2233、7799（级牌为8时，7和9相邻）
- 无主时两对级牌不能构成拖拉机
- **注意**: 拖拉机中的级牌会随当前级别变化

#### 甩牌规则
- **定义**: 将手中某门花色的多张牌一起打出
- **条件**: 甩牌前需确认其他三家无更大牌型
- **失败处理**: 甩牌失败需强制出最小牌
- **将吃处理**: 甩牌被将吃时按将吃规则处理
- **牌型要求**: 甩牌中可以包含单张、对子、连对等，但必须确认其他三家无更大组合
- **跟牌原则**: 甩牌被跟牌时，按甩牌中包含的组合类型，遵循跟牌规则

#### 抠底倍数
- 单张：2倍
- 对子：4倍  
- 连对：8倍（每多一对×2）
- 甩牌：按最大牌型计算倍数

## 🤝 贡献

我们欢迎所有形式的贡献！

### 如何贡献

1. Fork 这个项目
2. 创建你的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交你的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 Pull Request

### 开发指南

- 遵循现有的代码风格
- 添加适当的注释和文档
- 确保所有测试通过
- 更新README（如果需要）

## 📝 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 📞 联系方式

- **项目链接**: [https://github.com/EmericZLT/quatre-vingt](https://github.com/EmericZLT/quatre-vingt)

## 🙏 致谢

- 感谢所有贡献者
- 感谢开源社区提供的优秀工具和库
- 特别感谢Vue.js、FastAPI和所有依赖库的维护者

---

⭐ 如果这个项目对你有帮助，请给我们一个星标！