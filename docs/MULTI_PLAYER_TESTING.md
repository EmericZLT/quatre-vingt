# 多玩家测试指南

## 功能概述

已实现多玩家连接功能，包括：
- 房间列表和创建/加入房间
- 每个房间最多4名玩家
- 每个玩家只能看到和操作自己的手牌
- 其他玩家的手牌只显示数量，不显示具体牌

## 如何测试多玩家场景

### 方法一：使用多个浏览器窗口（推荐）

1. **启动后端服务器**
   ```bash
   cd backend
   python main.py
   ```

2. **启动前端开发服务器**
   ```bash
   cd frontend
   npm run dev
   ```

3. **打开多个浏览器窗口/标签页**
   - 打开第一个窗口：访问 `http://localhost:5173/rooms`
   - 打开第二个窗口：访问 `http://localhost:5173/rooms`
   - 打开第三个窗口：访问 `http://localhost:5173/rooms`
   - 打开第四个窗口：访问 `http://localhost:5173/rooms`

4. **创建和加入房间**
   - 在第一个窗口：输入房间名称（如"测试房间1"）和玩家名称（如"玩家1"），点击"创建房间"
   - 在第二个窗口：在房间列表中找到"测试房间1"，输入玩家名称（如"玩家2"），点击"加入"
   - 在第三个窗口：输入玩家名称（如"玩家3"），点击"加入"
   - 在第四个窗口：输入玩家名称（如"玩家4"），点击"加入"

5. **开始游戏**
   - 所有玩家进入游戏界面后，任意一个玩家点击"连接服务器"
   - 然后点击"开始游戏"
   - 点击"自动发牌"

6. **验证功能**
   - 每个玩家应该只能看到自己的手牌（完整显示）
   - 其他玩家的手牌区域只显示数量，不显示具体牌
   - 每个玩家的手牌应该正确排序

### 方法二：使用浏览器隐私模式/无痕模式

1. 打开一个普通浏览器窗口
2. 打开一个隐私模式/无痕模式窗口
3. 重复上述步骤3-6

### 方法三：使用不同浏览器

1. 使用Chrome打开一个窗口
2. 使用Firefox/Edge打开另一个窗口
3. 重复上述步骤3-6

### 方法四：使用移动设备

1. 确保移动设备和电脑在同一网络
2. 在移动设备浏览器访问：`http://[你的电脑IP]:5173/rooms`
3. 在电脑浏览器访问：`http://localhost:5173/rooms`
4. 重复上述步骤3-6

## 测试要点

### 1. 房间管理
- ✅ 创建房间功能正常
- ✅ 加入房间功能正常
- ✅ 房间列表实时更新
- ✅ 房间满员后无法加入

### 2. 玩家身份
- ✅ 每个玩家有唯一的player_id
- ✅ 每个玩家有固定的位置（NORTH/WEST/SOUTH/EAST）
- ✅ 玩家信息正确显示在界面上

### 3. 手牌隐私
- ✅ 只能看到自己的手牌
- ✅ 其他玩家的手牌只显示数量
- ✅ 发牌时只有收到牌的玩家能看到自己的新牌

### 4. 游戏同步
- ✅ 所有玩家看到相同的游戏状态（阶段、发牌进度等）
- ✅ 发牌过程对所有玩家同步
- ✅ 手牌排序正确

## 常见问题

### Q: 如何查看不同玩家的视角？
A: 打开多个浏览器窗口，每个窗口使用不同的玩家名称加入房间，每个窗口会显示该玩家的视角。

### Q: 如何测试4个玩家？
A: 打开4个浏览器窗口，分别用4个不同的玩家名称加入同一个房间。

### Q: 如何验证手牌隐私？
A: 在多个窗口中，对比不同玩家的界面，应该看到：
- 自己的手牌：完整显示所有卡牌
- 其他玩家的手牌：只显示数量，不显示具体牌

### Q: 如何测试房间满员？
A: 尝试用第5个玩家加入已有4名玩家的房间，应该显示"房间已满"。

## 技术细节

### WebSocket连接
- URL格式：`ws://127.0.0.1:8000/ws/game/{room_id}?player_id={player_id}`
- 每个连接必须提供有效的player_id
- player_id必须在房间的玩家列表中

### 数据流
1. 创建/加入房间 → 获取room_id和player_id
2. 使用room_id和player_id连接WebSocket
3. 后端验证player_id是否在房间中
4. 后端只发送该玩家的手牌给对应连接
5. 其他玩家的手牌信息只包含数量

### 存储
- 房间信息存储在内存中（backend/app/api/game.py的rooms字典）
- 玩家信息存储在roomStore中（前端Pinia store）
- 刷新页面后需要重新加入房间

